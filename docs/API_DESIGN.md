# API設計書

## 概要
卓日程くんアプリケーションのRESTful API設計書

## 基本情報
- **ベースURL**: `/api/v1`
- **認証方式**: JWT Token（Devise）
- **レスポンス形式**: JSON
- **エラーハンドリング**: 標準的なHTTPステータスコード

## 共通レスポンス形式

### 成功時
```json
{
  "status": "success",
  "data": { ... },
  "message": "処理が完了しました"
}
```

### エラー時
```json
{
  "status": "error",
  "errors": [
    {
      "field": "フィールド名",
      "message": "エラーメッセージ"
    }
  ]
}
```

## エンドポイント一覧

### 1. ユーザー管理（Users）

#### 1.1 ユーザー一覧取得
- **エンドポイント**: `GET /users`
- **説明**: ユーザー一覧を取得（検索・フィルタリング対応）
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | id | bigint | - | ユーザーIDで検索 |
  | email | string | - | メールアドレスで検索 |
  | name | string | - | ユーザー名で検索 |

#### 1.2 ユーザー作成
- **エンドポイント**: `POST /users`
- **説明**: 新規ユーザーを作成
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 一意 | 説明 |
  |-------------|----|------|------|------|
  | email | string | ○ | ○ | 新規ユーザーのメールアドレス |
  | encrypted_password | string | ○ | - | 新規ユーザーのパスワード |
  | name | string | ○ | - | 新規ユーザー名 |

#### 1.3 ユーザー更新
- **エンドポイント**: `PUT /users/{id}`
- **説明**: 指定されたユーザーの情報を更新
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | email | string | - | メールアドレスの更新 |
  | name | string | - | ユーザー名の更新 |
  | encrypted_password | string | - | パスワードの更新 |

#### 1.4 ユーザー削除
- **エンドポイント**: `DELETE /users/{id}`
- **説明**: 指定されたユーザーを削除
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 一意 | 説明 |
  |-------------|----|------|------|------|
  | id | bigint | ○ | ○ | ユーザー削除 |

### 2. グループ管理（Groups）

#### 2.1 グループ一覧取得
- **エンドポイント**: `GET /groups`
- **説明**: グループ一覧を取得（検索・フィルタリング対応）
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | id | bigint | - | グループIDで検索 |
  | name | string | - | グループ名で検索 |

#### 2.2 グループ作成
- **エンドポイント**: `POST /groups`
- **説明**: 新規グループを作成
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | user_id | bigint | ○ | 作成者ユーザーID |
  | name | string | ○ | グループ名 |
  | intro | text | - | 紹介文 |

#### 2.3 グループ更新
- **エンドポイント**: `PUT /groups/{id}`
- **説明**: 指定されたグループの情報を更新
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | name | string | - | グループ名の更新 |
  | intro | text | - | 紹介文の更新 |

#### 2.4 グループ削除
- **エンドポイント**: `DELETE /groups/{id}`
- **説明**: 指定されたグループを削除
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 一意 | 説明 |
  |-------------|----|------|------|------|
  | id | bigint | ○ | ○ | グループ削除 |

### 3. メンバーシップ管理（Memberships）

#### 3.1 メンバーシップ一覧取得
- **エンドポイント**: `GET /memberships`
- **説明**: メンバーシップ一覧を取得（検索・フィルタリング対応）
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | id | bigint | - | メンバーIDで検索 |
  | user_id | bigint | - | ユーザーIDで検索 |
  | group_id | bigint | - | グループIDで検索 |

#### 3.2 メンバーシップ作成
- **エンドポイント**: `POST /memberships`
- **説明**: 新規メンバーシップを作成
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | user_id | bigint | ○ | 参加ユーザーID |
  | group_id | bigint | ○ | 参加グループID |
  | role | integer | - | 役割（KP/PL） |

#### 3.3 メンバーシップ更新
- **エンドポイント**: `PUT /memberships/{id}`
- **説明**: 指定されたメンバーシップの情報を更新
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 説明 |
  |-------------|----|------|------|
  | role | integer | - | 役割の更新 |

#### 3.4 メンバーシップ削除
- **エンドポイント**: `DELETE /memberships/{id}`
- **説明**: 指定されたメンバーシップを削除
- **パラメータ**:
  | パラメータ名 | 型 | 必須 | 一意 | 説明 |
  |-------------|----|------|------|------|
  | id | bigint | ○ | ○ | メンバー削除 |

## HTTPステータスコード

| ステータスコード | 説明 |
|----------------|------|
| 200 | OK - リクエスト成功 |
| 201 | Created - リソース作成成功 |
| 400 | Bad Request - リクエストが不正 |
| 401 | Unauthorized - 認証が必要 |
| 403 | Forbidden - アクセス権限なし |
| 404 | Not Found - リソースが見つからない |
| 422 | Unprocessable Entity - バリデーションエラー |
| 500 | Internal Server Error - サーバーエラー |

## 認証・認可

### JWT Token
- **ヘッダー**: `Authorization: Bearer {token}`
- **有効期限**: 24時間
- **更新**: リフレッシュトークンによる自動更新

### 権限管理
- **ユーザー**: 自分の情報のみ操作可能
- **グループ作成者**: 作成したグループの管理権限
- **管理者**: 全ユーザー・グループの管理権限

## レート制限

- **制限**: 1000リクエスト/時間
- **ヘッダー**: `X-RateLimit-Remaining`, `X-RateLimit-Reset`

## エラーレスポンス例

### バリデーションエラー
```json
{
  "status": "error",
  "errors": [
    {
      "field": "email",
      "message": "メールアドレスの形式が正しくありません"
    },
    {
      "field": "name",
      "message": "名前は20文字以内で入力してください"
    }
  ]
}
```

### 認証エラー
```json
{
  "status": "error",
  "message": "認証が必要です",
  "code": "UNAUTHORIZED"
}
```

### 権限エラー
```json
{
  "status": "error",
  "message": "この操作を実行する権限がありません",
  "code": "FORBIDDEN"
}
```

---

**作成日**: 2025年8月
**バージョン**: 1.0
**作成者**: AI Assistant 